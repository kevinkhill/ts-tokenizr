!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("assert")):"function"==typeof define&&define.amd?define(["exports","assert"],n):n((t=t||self).tsTokenizr={},t.assert)}(this,function(t,n){var e=function(){function t(t,n,e,i,r,s){void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=0),this.type=t,this.value=n,this.text=e,this.pos=i,this.line=r,this.column=s}var n=t.prototype;return n.toString=function(){return"<"+["type: "+this.type,"value: "+JSON.stringify(this.value),"text: "+JSON.stringify(this.text),"pos: "+this.pos,"line: "+this.line,"column: "+this.column].join(", ")+">"},n.isA=function(t,n){return t===this.type&&(!n||n===this.value)},t}(),i=function(){function t(t){this._repeat=!1,this._reject=!1,this._ignore=!1,this._data={},this._match=null,this._tokenizr=t}var n=t.prototype;return n.data=function(t,n){return void 0===n?this._data[t]:(this._data[t]=n,!0)},n.info=function(){return{line:this._tokenizr._line,column:this._tokenizr._column,pos:this._tokenizr._pos,len:this._match?this._match[0].length:NaN}},n.push=function(t){return this._tokenizr.push(t),this},n.pop=function(){return this._tokenizr.pop(),this},n.state=function(t){return void 0===t?this._tokenizr.state():(this._tokenizr.state(t),this)},n.tag=function(t){return this._tokenizr.tag(t),this},n.tagged=function(t){return this._tokenizr.tagged(t)},n.untag=function(t){return this._tokenizr.untag(t),this},n.repeat=function(){return this._tokenizr._log("    REPEAT"),this._repeat=!0,this},n.reject=function(){return this._tokenizr._log("    REJECT"),this._reject=!0,this},n.ignore=function(){return this._tokenizr._log("    IGNORE"),this._ignore=!0,this},n.accept=function(t,n){if(null===this._match)throw Error("this._match was null when trying to .accept()");return void 0===n&&(n=this._match[0]),this._tokenizr._log("    ACCEPT: type: "+t+", value: "+JSON.stringify(n)+" ("+typeof n+'), text: "'+this._match[0]+'"'),this._tokenizr._pending.push(new e(t,n,this._match[0],this._tokenizr._pos,this._tokenizr._line,this._tokenizr._column)),this},n.stop=function(){return this._tokenizr._stopped=!0,this},t}();function r(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}function o(){return(o=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t}).apply(this,arguments)}function u(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,n){return(a=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function l(t,n,e){return(l=c()?Reflect.construct:function(t,n,e){var i=[null];i.push.apply(i,n);var r=new(Function.bind.apply(t,i));return e&&a(r,e.prototype),r}).apply(null,arguments)}function f(t){var n="function"==typeof Map?new Map:void 0;return(f=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return l(t,arguments,h(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a(e,t)})(t)}function p(t){return t.charCodeAt(0).toString(16).toUpperCase()}function _(t,n,e){return t.substr(n,e).replace(/\\/g,"\\\\").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+p(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+p(t)}).replace(/[\u0100-\u0FFF]/g,function(t){return"\\u0"+p(t)}).replace(/[\u1000-\uFFFF]/g,function(t){return"\\u"+p(t)})}function g(t,n){var e=t.length,i=n-20;i<0&&(i=0);var r=n+20;return r>e&&(r=e),{prologTrunc:i>0,prologText:_(t,i,n-i),tokenText:_(t,n,1),epilogText:_(t,n+1,r-(n+1)),epilogTrunc:r<e}}var d=function(t){function n(n,e,i,r,s){var o;return(o=t.call(this,n)||this).name="ParsingError",o.message=n,o.pos=e,o.line=i,o.column=r,o.input=s,o}return u(n,t),n.prototype.toString=function(){for(var t=g(this.input,this.pos),n="line "+this.line+" (column "+this.column+"): ",e="",i=0;i<n.length+t.prologText.length;i++)e+=" ";return"Parsing Error: "+this.message+"\n"+n+t.prologText+t.tokenText+t.epilogText+"\n"+e+"^"},n}(f(Error)),m=function(t){var n=this;this.matched=!1,this.result=[],(this.matched=null!==t)&&(this.input=t.input,this.index=t.index,Object.entries(t).forEach(function(t){var e=t[0];"groups"!==e&&"input"!==e&&"index"!==e&&n.result.push(t[1])})),this.map=this.result.map,this.find=this.result.find,this.filter=this.result.filter,this.length=this.result.length,this.includes=this.result.includes};function v(t,e){if("string"!=typeof t)throw new n.AssertionError({expected:"string",actual:typeof t,message:e||"The given input must be a string."})}var y=function(t){function n(n){var e;return(e=t.call(this)||this).defaultState=n,e.defaultState=n,e.elements.push(e.defaultState),e}u(n,t);var e=n.prototype;return e.clear=function(){this.elements=[this.defaultState]},e.pop=function(){if(this.isEmpty)throw Error('ERROR: Cannot pop the default state "'+this.defaultState+'"');return this.elements.pop()},e.peek=function(){return this.elements[this.elements.length-1]},s(n,[{key:"isEmpty",get:function(){return 1===this.elements.length}}]),n}(function(){function t(){this.elements=[]}t.init=function(n){var e=new t;return e.push(n),e};var n=t.prototype;return n.clear=function(){this.elements=[]},n.push=function(t){return this.elements.push(t)},n.pop=function(){return this.elements.pop()},n.peek=function(){return this.isNotEmpty?this.elements[this.length-1]:void 0},s(t,[{key:"length",get:function(){return this.elements.length}},{key:"isEmpty",get:function(){return 0===this.length}},{key:"isNotEmpty",get:function(){return!this.isEmpty}}]),t}()),k=function(){function t(t){this.name="default",this.tags=[];var n=t.split(/\s+/g),e=n.filter(function(t){return!t.startsWith("#")});if(1!==e.length)throw new Error("exactly one state required");this.name=e[0],this.tags=n.filter(function(t){return t.startsWith("#")}).map(function(t){return t.replace("#","")})}t.default=function(){return new t("default")},t.create=function(n){return new t(n)};var n=t.prototype;return n.toString=function(){return this.name+" "+this.stringifyTags()},n.stringifyTags=function(){return this.tags.map(function(t){return"#"+t}).join(" ")},n.is=function(t){return this.name===t},n.matches=function(t){return this.name===t.name&&((n=this.tags)===(e=t.tags)||n.length===e.length&&n.map(function(t){return e.includes(t)}).reduce(function(t,n){return t&&n},!0));var n,e},n.filterTags=function(t){return this.tags.filter(t)},n.hasTag=function(t){return this.tags.includes(t)},n.tag=function(t){return this.tags.push(t),this},n.unTag=function(t){return delete this.tags[this.tags.indexOf(t)],this},s(t,[{key:"isTagged",get:function(){return this.tags.length>0}}]),t}(),x=function(){function t(){this._name="unknown",this._states=[],this.stringify={}}var n=t.prototype;return n.test=function(t){return new m(this._pattern.exec(t))},n.state=function(t){return v(t),this._states.find(function(n){return n.name===t})},n.hasState=function(t){return this._states.filter(function(n){return n.is(t)}).length>0},n.getState=function(t){if(!this.hasState(t))throw Error();return this._states.find(function(n){return n.is(t)})},n.getStates=function(){return this._states.map(function(t){return t.name})},n.setName=function(t){return this._name=t,this},n.setAction=function(t){return this._action=t,this},n.setState=function(t){var n=t.split(/\s*,\s*/g);return this._states=n.map(k.create),this},n.addState=function(t){return this._states.push(new k(t)),this},n.setPattern=function(t){var n="g";try{"boolean"==typeof new RegExp("","y").sticky&&(n="y")}catch(t){}return"boolean"==typeof t.multiline&&t.multiline&&(n+="m"),"boolean"==typeof t.dotAll&&t.dotAll&&(n+="s"),"boolean"==typeof t.ignoreCase&&t.ignoreCase&&(n+="i"),"boolean"==typeof t.unicode&&t.unicode&&(n+="u"),this._pattern=new RegExp(t.source,n),this},s(t,[{key:"states",get:function(){return this._states.map(function(t){return t.toString()})}},{key:"willMatchAnyState",get:function(){return this.hasState("*")}},{key:"hasPattern",get:function(){return void 0!==this._pattern}},{key:"hasAction",get:function(){return void 0!==this._action}},{key:"hasName",get:function(){return void 0!==this._name}}]),t}(),w=function(){function t(n){this._len=0,this._pos=0,this._line=1,this._column=1,this._input="",this._eof=!1,this._stopped=!1,this._rules=[],this._pending=[],this._after=null,this._before=null,this._finish=null,this._tag={},this._transaction=[],this.config=o({},t.defaults,n),this._state=new y("default"),this._ctx=new i(this)}var n=t.prototype;return n.reset=function(){return this._input="",this._len=0,this._eof=!1,this._pos=0,this._line=1,this._column=1,this._transaction=[],this._pending=[],this._stopped=!1,this._state.clear(),this._ctx=new i(this),this},n.error=function(t){return new d(t,this._pos,this._line,this._column,this._input)},n.debug=function(t){return this.config.debug=t,this},n.input=function(t){return v(t),this.reset(),this._input=t,this._len=t.length,this},n.push=function(t){var n=this._state.peek();return this._state.push(t),this._log("    STATE (PUSH): old: <"+n+">, new: <"+t+">"),this},n.pop=function(){if(this._state.length<2)throw new Error("no more custom states to pop");var t=this._state.pop();return this._log("    STATE (POP): old: <"+t+">, new: <"+this._state.peek()+">"),this},n.state=function(t){return void 0===t?this._state.peek():(this._log("    STATE (SET): old: <"+this._state.peek()+">, new: <"+t+">"),this._state.push(t),this)},n.tag=function(t){return this._tag[t]=!0,this._log("    TAG (ADD): "+t),this},n.tagged=function(t){return!0===this._tag[t]},n.untag=function(t){return delete this._tag[t],this._log("    TAG (DEL): "+t),this},n.before=function(t){return this._before=t,this},n.after=function(t){return this._after=t,this},n.finish=function(t){return this._finish=t,this},n.rule=function(t,n,e,i){void 0===e&&(e="unknown"),void 0===i&&(i="unknown");var r=new x;return"string"==typeof t?r.setState(t):(r.setState("default"),r.setPattern(t)),void 0!==n.compile?r.setPattern(n):r.setAction(n),"string"==typeof e?r.setName(e):r.setAction(e),"string"==typeof i&&r.setName(i),this._rules.push(r),this.config.debug&&this._log("rule: configure rule (state: "+r.states+", pattern: "+r._pattern.source+")"),this},n.ignoreRule=function(t){return this.rule(t,function(t){return t.ignore()})},n.token=function(){if(0===this._pending.length&&this._tokenize(),this._pending.length>0){var t=this._pending.shift();if(t)return this._transaction.length>0&&this._transaction[0].push(t),this._log("TOKEN: "+t.toString()),t}return null},n.tokens=function(){for(var t,n=[];null!==(t=this.token());)n.push(t);return n},n.tokenGenerator=regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(n=this.token())){t.next=5;break}return t.next=3,n;case 3:t.next=0;break;case 5:case"end":return t.stop()}},t,this)}),n.tokenize=function(t){return this.input(t),this.tokens()},n.peek=function(t){void 0===t&&(t=0);for(var n=0;n<this._pending.length+t;n++)this._tokenize();if(t>=this._pending.length)throw new Error("not enough tokens available for peek operation");return this._log("PEEK: "+this._pending[t].toString()),this._pending[t]},n.skip=function(t){void 0===t&&(t=1);for(var n=0;n<this._pending.length+t;n++)this._tokenize();if(t>this._pending.length)throw new Error("not enough tokens available for skip operation");for(;t-- >0;)this.token();return this},n.consume=function(t,n){for(var e=this,i=0;i<this._pending.length+1;i++)this._tokenize();if(0===this._pending.length)throw new Error("not enough tokens available for consume operation");var r=this.token();this._log("CONSUME: "+r.toString());var s=function(n,i){throw new d("expected: <type: "+t+", value: "+JSON.stringify(n)+" ("+i+")>, found: <type: "+r.type+", value: "+JSON.stringify(r.value)+" ("+typeof r.value+")>",r.pos,r.line,r.column,e._input)};return n&&!r.isA(t,n)?s(n,typeof n):r.isA(t)||s("*","any"),r},n.begin=function(){return this._log("BEGIN: level "+this._transaction.length),this._transaction.unshift([]),this},n.depth=function(){if(0===this._transaction.length)throw new Error("cannot determine depth -- no active transaction");return this._transaction[0].length},n.commit=function(){if(0===this._transaction.length)throw new Error("cannot commit transaction -- no active transaction");return this._transaction.shift(),this._log("COMMIT: level "+this._transaction.length),this},n.rollback=function(){if(0===this._transaction.length)throw new Error("cannot rollback transaction -- no active transaction");return this._pending=this._transaction[0].concat(this._pending),this._transaction.shift(),this._log("ROLLBACK: level "+this._transaction.length),this},n.alternatives=function(){for(var t=[].slice.call(arguments),n=null,e=[],i=0;i<t.length;i++)try{this.begin(),n=t[i].call(this,this),this.commit();break}catch(t){e.push({error:t,depth:this.depth()}),this.rollback(),this._log("EXCEPTION: "+t.toString());continue}if(null===n&&e.length>0)throw(e=e.sort(function(t,n){return t.depth-n.depth}))[0].error;return n},n._log=function(t){this.config.debug&&console.log("tokenizr: "+t)},n._tokenize=function(){var t=this,n=function(){t._eof||(null!==t._finish&&t._finish.call(t._ctx,t._ctx),t._eof=!0,t._pending.push(new e("EOF","","",t._pos,t._line,t._column)))};if(!(this._stopped||this._pos>=this._len)){for(var i=!0;i;){if(i=!1,this.config.debug){var r=g(this._input,this._pos),s=Object.keys(this._tag).map(function(t){return"#"+t}).join(" ");this._log("INPUT: state: <"+this._state.peek()+">, tags: <"+s+">, text: "+(r.prologTrunc?"...":'"')+r.prologText+"<"+r.tokenText+">"+r.epilogText+(r.epilogTrunc?"...":'"')+", at: <line "+this._line+", column "+this._column+">")}for(var o=0;o<this._rules.length;o++){var u=this._rules[o];if(this.config.debug){var h=u.states[0];u.states.length>1&&(h=u.states.join(", ")),this._log("  RULE: state(s): <"+h+">, pattern: "+u._pattern.source)}var a=!1,c=!1,l=this._state.peek();if(!1===u.willMatchAnyState&&(c=u.hasState(l)),c){a=!0;var f=u.getState(l);f.isTagged&&f.filterTags(function(n){return!t._tag[n]}).length>0&&(a=!1)}if(a){u._pattern.lastIndex=this._pos;var p=u._pattern.exec(this._input);if(u._pattern.lastIndex=this._pos,null!==(p=u._pattern.exec(this._input))&&p.index===this._pos){if(this.config.debug&&this._log("    MATCHED: "+JSON.stringify(p)),this._ctx._match=p,this._ctx._repeat=!1,this._ctx._reject=!1,this._ctx._ignore=!1,null!==this._before&&this._before.call(this._ctx,this._ctx,p,u),u._action.call(this._ctx,this._ctx,p,u),null!==this._after&&this._after.call(this._ctx,this._ctx,p,u),this._ctx._reject)continue;if(this._ctx._repeat){i=!0;break}if(this._ctx._ignore){if(this._progress(this._pos,u._pattern.lastIndex),this._pos=u._pattern.lastIndex,this._pos>=this._len)return void n();i=!0;break}if(this._pending.length>0)return this._progress(this._pos,u._pattern.lastIndex),this._pos=u._pattern.lastIndex,void(this._pos>=this._len&&n());throw new Error('action of pattern "'+u._pattern.source+'" neither rejected nor accepted any token(s)')}}}}throw this.error("token not recognized")}n()},n._progress=function(t,n){for(var e=this._line,i=this._column,r=this._input,s=t;s<n;s++){var o=r.charAt(s);"\r"===o?this._column=1:"\n"===o?(this._line++,this._column=1):"\t"===o?this._column+=8-this._column%8:this._column++}this._log("    PROGRESS: characters: "+(n-t)+", from: <line "+e+", column "+i+">, to: <line "+this._line+", column "+this._column+">")},t}();w.defaults={debug:!1},t.ActionContext=i,t.ParsingError=d,t.Token=e,t.Tokenizr=w});
//# sourceMappingURL=ts-tokenizr.umd.js.map
